#!/bin/sh

#  __  __       _       _____     _     _
# |  \/  | __ _| | ____|_   _|_ _| |__ | | ___
# | |\/| |/ _` | |/ / _ \| |/ _` | '_ \| |/ _ \
# | |  | | (_| |   <  __/| | (_| | |_) | |  __/
# |_|  |_|\__,_|_|\_\___||_|\__,_|_.__/|_|\___|
# Convert a csv file into a LaTeX table
# ---------------------------------------------
# By Mavpt

# How to use:
# maketable number-of-columns format-file output-file

n=1
columns='c'

while [ "$n" -lt "$1" ]
do
        n=$(($n + 1))
        columns="$columns|c"
done

formattitle=$(sed "s/+$[0-9]* / /g ; s/+$[0-9]*$/ /g ; s/ / \"\\\t\&\" /g ; s/$/"'\"\\\\\\\\\\\\hline"'"/g" $2)
format=$(sed "s/^/\"$\"/g ; s/ / \"$\\\t\&$\" /g ; s/+/ \"\\\pm\" /g ; s/$/"'\"$\\\\\\\\"'"/g" $2)

printf '#!/usr/bin/awk -f\n# This program was autogenerated using maketable\n\n' > $3

begintext='\\begin{table*}[b]\\centering\\begin{tabular}{'$columns'}'
printf 'BEGIN { FS="," ; print "%s" }\n\n' $begintext >> $3

printf 'FNR==1 { print %s }\n\n' "$formattitle" >> $3
printf 'FNR>1 { print %s }\n\n' "$format" >> $3

printf 'END { print "%s" }' '\end{tabular}\n\caption{}\n\label{tab:}\end{table}' >> $3
